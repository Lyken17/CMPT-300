<!DOCTYPE html><html><head><title>HW2 Report</title><meta charset='utf-8'><link href='https://d31qtcb7c58z3n.cloudfront.net/res-min/themes/marxico.css' rel='stylesheet'></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-1" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-2" class="wmd-preview-section preview-content">

<h1 id="hw2-report">HW2 Report</h1>

</div><div id="wmd-preview-section-3" class="wmd-preview-section preview-content">

<h2 id="overview">Overview</h2>

<p>There are two kinds of processes. Child processes are doing the same tasks as hw1, while parent process does the creating and listening part. The program logic is shown below:</p>

<blockquote>
  <p>parent creates childres <br>
  –&gt; [Child] Do its task <br>
  –&gt; [Parent] Listen each childs status <br>
  ——–&gt; [Parent] When child exits, print log.</p>
</blockquote>

</div><div id="wmd-preview-section-4" class="wmd-preview-section preview-content">

<h2 id="implementation">Implementation</h2>

<p>First, I modified previous main function in hw1 from</p>

</div><div id="wmd-preview-section-5" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * argv[])</span> </span>{<br>FILE *fin = fopen(argv[<span class="hljs-number">1</span>],<span class="hljs-string">"r"</span>);<br>FILE *fout = fopen(argv[<span class="hljs-number">2</span>],<span class="hljs-string">"w"</span>);<br>Handle(fin,fout);<br>}<br></code></pre>

<p>to</p>

</div><div id="wmd-preview-section-6" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lyrebird</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *inputFile, <span class="hljs-keyword">char</span> *outputFile)</span> </span>{<br>FILE *fin = fopen(inputFile,<span class="hljs-string">"r"</span>);<br>FILE *fout = fopen(outputFile,<span class="hljs-string">"w"</span>);<br>Handle(fin,fout);<br>}<br></code></pre>

<p>Make previous homework as a function easier to call. <br>
Then, I used a fork() template from stackoverflow to build skeleton.</p>

</div><div id="wmd-preview-section-7" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-c++ hljs cpp"><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>{<br>    pid = fork();<br>    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span> || pid == -<span class="hljs-number">1</span>) <span class="hljs-keyword">break</span>;<br>    <span class="hljs-comment">//parent process print log</span><br>}<br><span class="hljs-keyword">if</span> (pid == -<span class="hljs-number">1</span>)<br>{<br>    <span class="hljs-built_in">exit</span>(-<span class="hljs-number">1</span>);<br>}<br><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(pid == 0)</span> <br></span>{<br>   <span class="hljs-comment">//child process</span><br>}<br><span class="hljs-keyword">else</span> <br>{<br>    <span class="hljs-comment">//parent process</span><br>}<br></code></pre>

<p>Integrate two together, final implementation </p>

</div><div id="wmd-preview-section-1727" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-c++ hljs cpp"><span class="hljs-keyword">while</span> (ReadFileLine != EOF) {<br>    readIn(inputFile,outputFile);<br>    pid = fork();<br>    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span> || pid == -<span class="hljs-number">1</span>) <span class="hljs-keyword">break</span>;<br>    <span class="hljs-comment">//Print creating log</span><br>}<br><br><span class="hljs-keyword">if</span> (pid == -<span class="hljs-number">1</span>) <span class="hljs-comment">//Create fail</span><br>{<br>    <span class="hljs-comment">//Print create fail log</span><br>}<br><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(pid == 0)</span> <span class="hljs-comment">//child process</span><br></span>{<br>    lyrebird(inputFile, outputFile);<br>    <span class="hljs-comment">//Print decryption complete log</span><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>}<br><span class="hljs-keyword">else</span> <span class="hljs-comment">//parent process</span><br>{<br>    <span class="hljs-keyword">while</span>(Still has existing child) {<br>        <span class="hljs-keyword">if</span> (status/<span class="hljs-number">256</span> != <span class="hljs-number">0</span>) {<br>            <span class="hljs-comment">//Print terminate fail log</span><br>        }<br>    }<br>}<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br></code></pre></div><div id="wmd-preview-section-280" class="wmd-preview-section preview-content">

<h2 id="test">Test</h2>

<ul><li>config_txt: (Test sample from hw1)</li>
</ul></div><div id="wmd-preview-section-10" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs stylus">./test/a1<span class="hljs-class">.in</span> ./test/a1<span class="hljs-class">.out</span><br>./test/a2<span class="hljs-class">.in</span> ./test/a2<span class="hljs-class">.out</span><br>./test/a2<span class="hljs-class">.txt</span> ./test/a2_out<span class="hljs-class">.txt</span><br>./test/t2-et-Assignment-Example<span class="hljs-class">.txt</span> ./test/a3_out<span class="hljs-class">.txt</span><br>./test/t5-et-Single-Tweet-<span class="hljs-number">1</span>-char<span class="hljs-class">.txt</span> ./test/a4_out<span class="hljs-class">.txt</span><br>./test/t7-et-Single-Tweet-<span class="hljs-number">139</span>-chars<span class="hljs-class">.txt</span> ./test/a5_out<span class="hljs-class">.txt</span><br>./test/t8-et-Single-Tweet-<span class="hljs-number">140</span>-chars<span class="hljs-class">.txt</span> ./test/a6_out<span class="hljs-class">.txt</span><br>./test/t9-et-File-with-<span class="hljs-number">10</span>-tweets<span class="hljs-class">.txt</span> ./test/a7_out.txt<br></code></pre>

<ul><li>File structure:</li>
</ul>

</div><div id="wmd-preview-section-1769" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs stylus">├── README<br>├── awesome<span class="hljs-class">.c</span><br>├── awesome<span class="hljs-class">.h</span><br>├── config_file<span class="hljs-class">.txt</span><br>├── main<span class="hljs-class">.c</span><br>├── makefile<br>├── memwatch<span class="hljs-class">.c</span><br>├── memwatch<span class="hljs-class">.h</span><br>├── report<span class="hljs-class">.html</span><br>├── rush<br>└── test<br>    ├── a1<span class="hljs-class">.in</span><br>    ├── a1<span class="hljs-class">.out</span><br>    ├── a2<span class="hljs-class">.in</span><br>    ├── a2<span class="hljs-class">.out</span><br>    ├── a2<span class="hljs-class">.txt</span><br>    ├── a2_out<span class="hljs-class">.txt</span><br>    ├── a3_out<span class="hljs-class">.txt</span><br>    ├── a4_out<span class="hljs-class">.txt</span><br>    ├── a5_out<span class="hljs-class">.txt</span><br>    ├── a6_out<span class="hljs-class">.txt</span><br>    ├── a7_out<span class="hljs-class">.txt</span><br>    ├── t2-et-Assignment-Example<span class="hljs-class">.txt</span><br>    ├── t5-et-Single-Tweet-<span class="hljs-number">1</span>-char<span class="hljs-class">.txt</span><br>    ├── t6-et-Single-Tweet-<span class="hljs-number">20</span>-chars<span class="hljs-class">.txt</span><br>    ├── t7-et-Single-Tweet-<span class="hljs-number">139</span>-chars<span class="hljs-class">.txt</span><br>    ├── t8-et-Single-Tweet-<span class="hljs-number">140</span>-chars<span class="hljs-class">.txt</span><br>    └── t9-et-File-with-<span class="hljs-number">10</span>-tweets.txt<br></code></pre>

<p>To test whether program runs in normal case. </p></div><div id="wmd-preview-section-1198" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs stylus">➜  hw2 git:(master) ✗ ./lyrebird config_file<span class="hljs-class">.txt</span><br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#980</span>5 created to decrypt ./test/a1<span class="hljs-class">.in</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#980</span>6 created to decrypt ./test/a2<span class="hljs-class">.in</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#980</span>7 created to decrypt ./test/a2<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#980</span>8 created to decrypt ./test/t2-et-Assignment-Example<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#980</span>9 created to decrypt ./test/t5-et-Single-Tweet-<span class="hljs-number">1</span>-char<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#981</span>0 created to decrypt ./test/t7-et-Single-Tweet-<span class="hljs-number">139</span>-chars<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/a2<span class="hljs-class">.in</span> complete. Process ID <span class="hljs-hexcolor">#980</span>6 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/a1<span class="hljs-class">.in</span> complete. Process ID <span class="hljs-hexcolor">#980</span>5 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#981</span>1 created to decrypt ./test/t8-et-Single-Tweet-<span class="hljs-number">140</span>-chars<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/t5-et-Single-Tweet-<span class="hljs-number">1</span>-char<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#980</span>9 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/t2-et-Assignment-Example<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#980</span>8 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/t7-et-Single-Tweet-<span class="hljs-number">139</span>-chars<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#981</span>0 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#981</span>2 created to decrypt ./test/t9-et-File-with-<span class="hljs-number">10</span>-tweets<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/t8-et-Single-Tweet-<span class="hljs-number">140</span>-chars<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#981</span>1 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/t9-et-File-with-<span class="hljs-number">10</span>-tweets<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#981</span>2 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">16</span>:<span class="hljs-number">21</span> <span class="hljs-number">2015</span>] Decryption of ./test/a2<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#980</span>7 Exiting.<br></code></pre>

<p>All processes run as expected, and after checking each output file one by one, outputs are right as well. <br>
Then, to simulate abnormal exiting, I delete some input files(./test/t7-et-Single-Tweet-139-chars.txt, ./test/t2-et-Assignment-Example.txt, ./test/a2.txt), and run program again.</p></div><div id="wmd-preview-section-1706" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs stylus">➜  hw2 git:(master) ✗ ./lyrebird config_file<span class="hljs-class">.txt</span><br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>2 created to decrypt ./test/a1<span class="hljs-class">.in</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>3 created to decrypt ./test/a2<span class="hljs-class">.in</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>4 created to decrypt ./test/a2<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Decryption of ./test/a1<span class="hljs-class">.in</span> complete. Process ID <span class="hljs-hexcolor">#984</span>2 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>5 created to decrypt ./test/t2-et-Assignment-Example<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Decryption of ./test/a2<span class="hljs-class">.in</span> complete. Process ID <span class="hljs-hexcolor">#984</span>3 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>6 created to decrypt ./test/t5-et-Single-Tweet-<span class="hljs-number">1</span>-char<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>7 created to decrypt ./test/t7-et-Single-Tweet-<span class="hljs-number">139</span>-chars<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>8 created to decrypt ./test/t8-et-Single-Tweet-<span class="hljs-number">140</span>-chars<span class="hljs-class">.txt</span>.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Decryption of ./test/t5-et-Single-Tweet-<span class="hljs-number">1</span>-char<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#984</span>6 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>9 created to decrypt ./test/t9-et-File-with-<span class="hljs-number">10</span>-tweets<span class="hljs-class">.txt</span>.<br><font color="red">[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>7 did not terminate successfully.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>5 did not terminate successfully.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#984</span>4 did not terminate successfully.</font><br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Decryption of ./test/t8-et-Single-Tweet-<span class="hljs-number">140</span>-chars<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#984</span>8 Exiting.<br>[Thu Oct <span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">21</span>:<span class="hljs-number">49</span> <span class="hljs-number">2015</span>] Decryption of ./test/t9-et-File-with-<span class="hljs-number">10</span>-tweets<span class="hljs-class">.txt</span> complete. Process ID <span class="hljs-hexcolor">#984</span>9 Exiting. <br></code></pre>

<p>Three “child process didn’t terminate successfully” log printed, as expected.</p></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>
