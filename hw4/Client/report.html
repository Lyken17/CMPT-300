<!DOCTYPE html><html><head><title>HW3 REPORT</title><meta charset='utf-8'><link href='https://d31qtcb7c58z3n.cloudfront.net/res-min/themes/marxico.css' rel='stylesheet'></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-19" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-42" class="wmd-preview-section preview-content">

<h1 id="hw3-report">HW3 REPORT</h1></div><div id="wmd-preview-section-483" class="wmd-preview-section preview-content">

<h2 id="overview">Overview</h2>

<p>There are two kinds of processes. Child processes are doing the same tasks as hw1, while parent process does the creating and listening part. The program logic is shown below:</p>

<ul><li>Parent creates children as number of (cores - 1) <br>
<ul>
<li>Each child gets task from parent and handle it until receives a end singal.</li>
<li>Parent gives each child task according to adapted schedule plan.</li></ul></li>
</ul>

<p>Processes communicate with each other by pipeline. There are two pipelines, parent -&gt; child and child -&gt; parent.</p></div><div id="wmd-preview-section-198" class="wmd-preview-section preview-content">

<h2 id="implementation">Implementation</h2>

<ul><li>Create children <br>
Modify hw2’s a fork() little bit</li>
</ul></div><div id="wmd-preview-section-1994" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-c++ hljs cpp"><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>{<br>    pipe(ppline[i].toChild) || pipe(ppline[i].toParent);<span class="hljs-comment">//Create pipeline</span><br>    pid = fork();<br>    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span> || pid == -<span class="hljs-number">1</span>) <span class="hljs-keyword">break</span>;<br>    pidList[i] = pid; <span class="hljs-comment">//record pid</span><br>}<br></code></pre>

<ul><li>Whole logic</li>
</ul></div><div id="wmd-preview-section-1945" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-c++ hljs cpp"><span class="hljs-keyword">if</span> (pid == -<span class="hljs-number">1</span>)<br>    HandleError()<br>}<br><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(pid == 0)</span> <span class="hljs-comment">//Child process</span><br></span>{<br>    send_message_parent();<span class="hljs-comment">//Initialised to be free</span><br>    <span class="hljs-keyword">while</span>(not_receive_finish_signal())<br>    {<br>        getTask(file);<br>        print <span class="hljs-built_in">log</span>;<br>        handleTask(file);<br>        send_message_parent();<span class="hljs-comment">//tell parent this process is free</span><br>    }<br>    closePipeline(toParent);<br>    <span class="hljs-built_in">exit</span>(EXIT_SUCCESS);<br>}<br><span class="hljs-keyword">else</span> <span class="hljs-comment">//parent process</span><br>{<br>    <span class="hljs-keyword">if</span> (schedulMethod == FCFS)<br>    {<br>        <span class="hljs-keyword">while</span>(readFile()!=EOF)<br>        {<br>            available = findFreeChild();<br>            print <span class="hljs-built_in">log</span>;<br>            sendTask(available);<br>        }<br>        send_finish_signal(allChildren);<br>        closePipeline(toChildren);<br>        handleError();<br>    }<br>    <span class="hljs-keyword">if</span> (scheduleMethod == ROUND_ROBIN)<br>    {<br>        n = children_number;<br>        count = taskCount;<br>        read each line of file, and make a task table of n * (taskCount / n + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">int</span> curTask[n];<br>        <span class="hljs-keyword">while</span>(n = findFreeChild() != -<span class="hljs-number">1</span>)<br>        {<br>            <span class="hljs-keyword">if</span> (thereIsTaskLeft)<br>                sendTask(n, taskTable[n][curTask[n]++]);<br>            <span class="hljs-keyword">else</span><br>            {<br>                send_finish_signal(n);<br>                closePipeline(toChild);<br>            }<br>        }<br>    }<br>}<br></code></pre>

<ul><li>Other part <br>
Mainly the same as hw2. </li>
</ul></div><div id="wmd-preview-section-1256" class="wmd-preview-section preview-content">

<h2 id="test">Test</h2>

<ul><li>File structure:</li>
</ul></div><div id="wmd-preview-section-3939" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs stylus">├── README<br>├── awesome<span class="hljs-class">.c</span><br>├── awesome<span class="hljs-class">.h</span><br>├── config_file<span class="hljs-class">.txt</span><br>├── main<span class="hljs-class">.c</span><br>├── makefile<br>├── memwatch<span class="hljs-class">.c</span><br>├── memwatch<span class="hljs-class">.h</span><br>├── monster<span class="hljs-comment">//To kill zombie processes</span><br>├── mypipe<span class="hljs-class">.c</span><br>├── mypipe<span class="hljs-class">.h</span><br>├── report<span class="hljs-class">.html</span><br>└── test<br>    ├── a1<span class="hljs-class">.in</span><br>    ├── ....<br>    └── aN.<span class="hljs-keyword">in</span><br></code></pre>

<ul><li><p>To test whether program in normal cases.  (Both FCFS and Round robin, the show below is FCFS)</p>

<pre class="prettyprint hljs-dark"><code class="hljs stylus">➜  hw2 git:(master) ✗ ./lyrebird config_file<span class="hljs-class">.txt</span><br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#659</span>26 will decrypt ./test/a1<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#659</span>26 decrypted ./test/a1<span class="hljs-class">.in</span> successfully.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#659</span>27 will decrypt ./test/a2<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#659</span>27 decrypted ./test/a2<span class="hljs-class">.in</span> successfully.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#659</span>28 will decrypt ./test/a3<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#659</span>28 decrypted ./test/a3<span class="hljs-class">.in</span> successfully.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#659</span>29 will decrypt ./test/a4<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">44</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#659</span>29 decrypted ./test/a4<span class="hljs-class">.in</span> successfully<br><br></code></pre>

<p>All processes run as expected, and after checking each output file one by one, outputs are right as well.  <br>
However ,Since my laptop is 4-core 8-threads,  all tasks are done in one round. The difference between FCFS and Round robin can’t be seen. So I set the core number to a constant 3 and test a big case. The program perform as expected,  both order and correctness. (Since the output log is too long, I didn’t attach it here).</p></li>
<li><p>Simulate abnormal situation <br>
As described in hw3, there are two kinds of error. Child process cannot find read-in file(which can continue) and child process abnormally exits (which cannot continue)</p>

<ul>
<li><p>Missing input file</p>

<pre class="prettyprint hljs-dark"><code class="hljs stylus">...<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#660</span>50 cannot find ./test/a9<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#660</span>51 will decrypt ./test/a3<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#660</span>51 decrypted ./test/a3<span class="hljs-class">.in</span> successfully.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#660</span>49 decrypted ./test/a8<span class="hljs-class">.in</span> successfully.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#660</span>49 will decrypt ./test/a15<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#660</span>49 cannot find ./test/a15<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#660</span>51 will decrypt ./test/a10<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">40</span>:<span class="hljs-number">34</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#660</span>51 cannot find ./test/a10<span class="hljs-class">.in</span>.<br>...<br><br></code></pre></li>
<li><p>Abnormally exit</p>

<pre class="prettyprint hljs-dark"><code class="hljs stylus">...<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#662</span>57 cannot find ./test/a15<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#662</span>59 will decrypt ./test/a10<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#662</span>59 cannot find ./test/a10<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#662</span>60 will decrypt ./test/a4<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#662</span>60 decrypted ./test/a4<span class="hljs-class">.in</span> successfully.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Child process ID <span class="hljs-hexcolor">#662</span>60 will decrypt ./test/a11<span class="hljs-class">.in</span>.<br>[Thu Nov <span class="hljs-number">12</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">15</span> <span class="hljs-number">2015</span>] Process ID <span class="hljs-hexcolor">#662</span>60 didn<span class="hljs-string">'t terminate successfully.</span><br></code></pre></li></ul>

<p>“child process didn’t terminate successfully” and “cannot find file” log printed, as expected.</p></li>
</ul></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>